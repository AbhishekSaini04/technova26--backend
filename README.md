# Technova26 Backend

A lightweight Express + TypeScript backend using Prisma (Postgres) for Technova26 event registration.

**Quick summary**

- **Entry:** `server.ts`
- **API base paths:** `/api/events`, `/api/registrations`
- **Static uploads:** served at `/uploads`

**Prerequisites**

- Node.js 18+ and `npm` (or `pnpm`/`yarn`)
- A Postgres-compatible database and a `DATABASE_URL` connection string

**Install**

```bash
npm install
```

**Environment**
Create a `.env` file at the project root. Minimum variables the app expects:

- `DATABASE_URL` : your Postgres connection string (required)
- `JWT_SECRET` : secret used to sign JWTs (required)
- `EMAILS` : optional comma-separated sender email addresses
- `EMAIL_PASSWORDS` : optional comma-separated passwords matching `EMAILS`
- `MAIL` : fallback single email address (optional)
- `MAIL_PASSWORD` : fallback email password (optional)

Example `.env` (DO NOT commit real secrets):

```
DATABASE_URL=postgresql://user:pass@host:5432/dbname
JWT_SECRET=your_jwt_secret_here
EMAILS=bot1@example.com,bot2@example.com
EMAIL_PASSWORDS=pass1,pass2
# or fallback
MAIL=bot@example.com
MAIL_PASSWORD=botpass
```

**Prisma / Database**

- Schema is at `prisma/schema.prisma` and Prisma client is generated into `generated/prisma`.
- Generate the client before running the app:

```bash
npx prisma generate
```

- To create or apply migrations in development:

```bash
npx prisma migrate dev --name init
```

Or to push schema changes without migrations:

```bash
npx prisma db push
```

**Run**

- Development (watch + tsx):

```bash
npm run dev
```

- Start (production-style):

```bash
npm run start
```

The server listens on port `3000` by default (see `server.ts`).

**API Endpoints (overview)**

- `GET /` : health / hello
- `POST /signup` : registers a user and sends OTP
- `POST /verify-otp` : verify OTP and create user
- `POST /login` : user login (returns JWT)
- `GET /api/events/*` : event-related endpoints (see `routes/event.routes.ts`)
- `GET /api/registrations/*` : registration-related endpoints (see `routes/registration.routes.ts`)
- `GET /api/departments` : static departments list
- `GET /api/departmentsWithEvents` : departments with events
- `GET /api/health` : service health

For route implementations see `controllers/` and `routes/`.

**Project layout**

- `server.ts` — app entry
- `controllers/` — request handlers
- `routes/` — express route definitions
- `services/` — business logic and helpers (email, OTP, eligibility)
- `lib/prisma.ts` — Prisma client setup (uses `DATABASE_URL`)
- `generated/prisma` — generated Prisma client (do not edit)
- `prisma/` — Prisma schema & migrations
- `uploads/` — static assets uploaded by multer

**Email sending**

- The code supports multiple sender accounts via `EMAILS` and `EMAIL_PASSWORDS` (comma-separated). If not present it falls back to `MAIL` / `MAIL_PASSWORD`.

**Notes & troubleshooting**

- Ensure `DATABASE_URL` is reachable and Prisma client is generated before starting.
- If you change the Prisma schema, run `npx prisma generate` and the appropriate migrate command.

**Contributing / Next steps**

- Add tests and CI configuration
- Add a `.env.example` file with placeholders
- Add endpoint documentation (OpenAPI / Postman)

---

Generated by repository maintainer assistant.
